<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ุชูุงุตูู ุงูุงุดุชุฑุงู ูุงูููุธููู</title>
  <style>
    body { font-family: Arial, sans-serif; direction: rtl; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; vertical-align: middle; }
    th { background-color: #f0f0f0; }
    .warning { color: red; font-weight: bold; }
    .success { color: green; font-weight: bold; }
    form input[type="text"],
    form input[type="email"],
    form input[type="file"],
    form select { margin: 5px; padding: 8px; width: 200px; }
    form button { padding: 8px 16px; margin-top: 5px; cursor: pointer; }
    img { border-radius: 4px; }
  </style>
</head>
<body>

<h2>ุชูุงุตูู ุงูุงุดุชุฑุงู ุงูุญุงูู</h2>

<% if (usage.hasSubscription && !usage.isExpired) { %>

  <!-- ุชูุงุตูู ุงูุฎุทุฉ -->
  <div>
    <p><strong>ุงุณู ุงูุฎุทุฉ:</strong> <%= usage.currentSubscription.plan.name %></p>
    <p><strong>ุงูุณุนุฑ:</strong> <%= usage.currentSubscription.plan.price %> ุฌ.ู</p>
    <p><strong>ุนุฏุฏ ุงูููุธููู ุงููุณููุญ:</strong> <%= usage.currentSubscription.plan.maxEmployees %></p>
    <p><strong>ุชุงุฑูุฎ ุงูุจุฏุงูุฉ:</strong> <%= new Date(usage.currentSubscription.startDate).toLocaleDateString("ar-EG") %></p>
    <p><strong>ุชุงุฑูุฎ ุงูููุงูุฉ:</strong> <%= new Date(usage.currentSubscription.endDate).toLocaleDateString("ar-EG") %></p>
  </div>

  <% const maxEmployees = usage.currentSubscription.plan.maxEmployees; %>
  <% const currentEmployees = usage.employees.length; %>

  <% if (currentEmployees < maxEmployees) { %>
    <h3>ุฅุถุงูุฉ ููุธู ุฌุฏูุฏ</h3>
    <p>โ ุฅุฌูุงูู ุนุฏุฏ ุงูุฒูุงุฑุงุช ููู ููุธูู ุงูุดุฑูุฉ: <strong><%= usage.totalVisitsCount %></strong></p>
    <p class="success">ุงููุชุจูู: <%= maxEmployees - currentEmployees %> ููุธู ูููู ุฅุถุงูุชูู</p>

    <form method="POST" action="/add-employee" enctype="multipart/form-data">
      <h2>ุงููุนูููุงุช ุงูุดุฎุตูู</h2>
      <input type="text" name="name" placeholder="ุงูุงุณู" required />
      <input type="text" name="jobTitle" placeholder="ุงููุณูู ุงููุธููู" required />
      <input type="text" name="phone" placeholder="ุฑูู ุงููุงุชู" required />
      <input type="email" name="email" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู" required />
      <input type="text" name="location" placeholder="ุงููููุน" />
      <input type="text" name="whatsapp" placeholder="ูุงุชุณุงุจ" />
      <input type="text" name="smsNumber" placeholder="ุฑูู SMS" />
      <input type="text" name="faxNumber" placeholder="ุฑูู ูุงูุณ" />
      <input type="text" name="telephone" placeholder="ุฑูู ุงููุงุชู ุงูููุฒูู " />
      <input type="text" name="wechat" placeholder="Wechat" />
      <label>ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ:</label>
      <input type="file" name="profileImage" accept="image/*" />
      <label>ุงูุตูุฑุฉ ุงูุซุงูููุฉ:</label>
      <input type="file" name="secondaryImage" accept="image/*" />
      <br/>
      <h2>ุงููุจุฐู</h2>
      <input type="text" name="aboutTitle" placeholder="ุนููุงู ุงููุจุฐุฉ" />
      <input type="text" name="about" placeholder="ูุจุฐุฉ ุนู ุงูููุธู" />
      <br/>
      <h2>ุชูุงุตู ูุนู</h2>
       <label>Contact Form Header Image:</label>
      <input type="file" name="contactFormHeaderImage" accept="image/*" />
      <input type="text" name="phoneTitle" placeholder="ุนููุงู ุงููุงุชู" />
      <input type="text" name="conphone" placeholder="ุฑูู ุงููุงุชู (ุซุงููู)" />
      <input type="text" name="emailTitle" placeholder="ุนููุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู" />
      <input type="email" name="conemail" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ุซุงููู)" />
      <input type="text" name="locationTitle" placeholder="ุนููุงู ุงููููุน" />
      <input type="text" name="conStreet" placeholder="ุงูุดุงุฑุน" />
      <input type="text" name="conAdressLine" placeholder="ุงูุนููุงู ุงูุฅุถุงูู" />
      <input type="text" name="conCity" placeholder="ุงููุฏููุฉ" />
      <input type="text" name="conState" placeholder="ุงููุญุงูุธุฉ" />
      <input type="text" name="conCountry" placeholder="ุงูุฏููุฉ" />
      <input type="text" name="conZipcode" placeholder="ุงูุฑูุฒ ุงูุจุฑูุฏู" />
      <input type="text" name="conDirection" placeholder="ุงูุงุชุฌุงูุงุช" />
      <input type="text" name="conGoogleMapUrl" placeholder="ุฑุงุจุท Google Map" />
      <br/>
      <h2>ุงูุตูุฑ</h2>
      <label>ุตูุฑ ุฅุถุงููุฉ (ุฌุงููุฑู):</label>
      <input type="file" name="galleryImages" accept="image/*" multiple />
      <br/>
      <h2>ููุงูุน ุงูุชูุงุตู ุงูุงุฌุชูุงุนู</h2>
       <label>Facebook Image:</label>
      <input type="file" name="facebookImage" accept="image/*" />
      <input type="text" name="facebook" placeholder="ุฑุงุจุท Facebook" />
      <label>Instagram Image:</label>
      <input type="file" name="instagramImage" accept="image/*" />
      <input type="text" name="instagram" placeholder="ุฑุงุจุท Instagram" />
      <label>TikTok Image:</label>
      <input type="file" name="tiktokImage" accept="image/*" />
      <input type="text" name="tiktok" placeholder="ุฑุงุจุท TikTok" />
      <label>Snapchat Image:</label>
      <input type="file" name="snapchatImage" accept="image/*" />     
      <input type="text" name="snapchat" placeholder="ุฑุงุจุท Snapchat" />
      <br/>
      <h2> ุฑูุงุจุท</h2>
      <input type="text" name="workLink" placeholder="ุฑุงุจุท ุงูุนูู" />
      <input type="text" name="productsLink" placeholder="ุฑุงุจุท ุงูููุชุฌุงุช" />
       <br/>
      <h2>ุงูุชูุตูุฉ</h2>
      <input type="text" name="testimonialTitle" placeholder="ุนููุงู ุงูุชูุตูุฉ" />
      <input type="text" name="testimonialDescription" placeholder="ูุตู ุงูุชูุตูุฉ" />
      <input type="text" name="testimonialText" placeholder="ูุต ุงูุชูุตูุฉ" />
      <input type="text" name="testimonialName" placeholder="ุงุณู ุตุงุญุจ ุงูุชูุตูุฉ" />
      <input type="text" name="testimonialDesignation" placeholder="ูุธููุฉ ุตุงุญุจ ุงูุชูุตูุฉ" />
      <label>Testimonial Image:</label>
      <input type="file" name="testimonialImage" accept="image/*" />
      <br/>
      <h2>ุงูููุฏูู</h2>
      <input type="text" name="videoTitle" placeholder="ุนููุงู ุงูููุฏูู" />
      <input type="text" name="videoDescription" placeholder="ูุตู ุงูููุฏูู" />
      <input type="text" name="videoUrl" placeholder="ุฑุงุจุท ุงูููุฏูู" />
      <select name="videoType">
        <option value="">ููุน ุงูููุฏูู</option>
        <option value="youtube">YouTube</option>
        <option value="vimeo">Vimeo</option>
      </select>
      <br/>
      <h2>pdf</h2>
      <input type="text" name="pdfGalleryTitle" placeholder="ุนููุงู pdf" />
      <input type="text" name="pdfGalleryDescription" placeholder="ูุตู pdf" />
      <input type="text" name="pdfGalleryDescription" placeholder="ูุตู pdf" />
      <input type="file" name="pdfFileUrl" accept=".pdf" required />
      <input type="text" name="pdfTitle" placeholder="ุนููุงู ูุจุณุท ูููู pdf" />
      <input type="text" name="pdfSubtitle" placeholder="ูุตู  ูููู pdf" />
      <label>PDF image:</label>
      <input type="file" name="pdfThumbnail" accept="image/*" />
      <br/>
      <h2> ูููุฐุฌ ุงูุชูุงุตู </h2>
      <input type="text" name="contactFormTitle" placeholder="ุนููุงู ูููุฐุฌ ุงูุชูุงุตู" />
      <input type="text" name="contactFormDescription" placeholder="ูุตู ุงููููุฐุฌ" />
      <select name="contactFormDisplayType">
        <option value="">ุทุฑููุฉ ุงูุนุฑุถ</option>
        <option value="overlay">Overlay</option>
        <option value="inline">Inline</option>
      </select>
      <br/>
      <h2>ุงูุชุตูููุงุช</h2>
      <label for="designId">ุงุฎุชุฑ ุงูุชุตููู:</label>
      <select name="designId" id="designId" required>    
        <option value="card-minimal">ุชุตููู 1 (ููุงุณูู)</option>
        <option value="card-dark">ุชุตููู 2 (ููุฏุฑู)</option>
        <option value="card-modern">ุชุตููู 3 (ุฅููุงุฌุงูุณ)</option>
      </select>
      <br/>
 <h2>ุณุงุนุงุช ุงูุนูู</h2>
  <div>
    <label>
      <input type="checkbox" id="showWorkingHours" name="showWorkingHours" value="false" />
      ุชูุนูู ุนุฑุถ ููุงุนูุฏ ุงูุนูู
    </label>
  </div>

  <div>
    <label>
      <input type="checkbox" id="isOpen24Hours" name="isOpen24Hours" value="false" disabled />
      ููุชูุญ 24 ุณุงุนุฉ
    </label>
  </div>

  <div>
    <label>ุตูุฑุฉ ููุงุนูุฏ ุงูุนูู:
      <input type="file" name="workingHoursImage" accept="image/*" />
    </label>
  </div>

  <div id="workingHoursSection" style="display:none;">
    <h3>ุฌุฏูู ุงูุฃูุงู</h3>
    <div><label>ุงูุงุซููู: ูู <input type="time" name="workingHours[monday][from]" /> ุฅูู <input type="time" name="workingHours[monday][to]" /></label></div>
    <div><label>ุงูุซูุงุซุงุก: ูู <input type="time" name="workingHours[tuesday][from]" /> ุฅูู <input type="time" name="workingHours[tuesday][to]" /></label></div>
    <div><label>ุงูุฃุฑุจุนุงุก: ูู <input type="time" name="workingHours[wednesday][from]" /> ุฅูู <input type="time" name="workingHours[wednesday][to]" /></label></div>
    <div><label>ุงูุฎููุณ: ูู <input type="time" name="workingHours[thursday][from]" /> ุฅูู <input type="time" name="workingHours[thursday][to]" /></label></div>
    <div><label>ุงูุฌูุนุฉ: ูู <input type="time" name="workingHours[friday][from]" /> ุฅูู <input type="time" name="workingHours[friday][to]" /></label></div>
    <div><label>ุงูุณุจุช: ูู <input type="time" name="workingHours[saturday][from]" /> ุฅูู <input type="time" name="workingHours[saturday][to]" /></label></div>
    <div><label>ุงูุฃุญุฏ: ูู <input type="time" name="workingHours[sunday][from]" /> ุฅูู <input type="time" name="workingHours[sunday][to]" /></label></div>
  </div>

  <button type="submit">โ ุฅุถุงูุฉ ุงูููุธู</button>
</form>

<script>
  const form = document.getElementById('employeeForm');
  const showCheckbox = document.getElementById('showWorkingHours');
  const open24Checkbox = document.getElementById('isOpen24Hours');
  const workingHoursSection = document.getElementById('workingHoursSection');

  showCheckbox.addEventListener('change', () => {
    showCheckbox.value = showCheckbox.checked ? "true" : "false";
    open24Checkbox.disabled = !showCheckbox.checked;
    workingHoursSection.style.display = showCheckbox.checked && !open24Checkbox.checked ? "block" : "none";
  });

  open24Checkbox.addEventListener('change', () => {
    open24Checkbox.value = open24Checkbox.checked ? "true" : "false";
    workingHoursSection.style.display = open24Checkbox.checked ? "none" : "block";
  });

  form.addEventListener('submit', async function (e) {
    e.preventDefault();

    const formData = new FormData(form);

    formData.set('showWorkingHours', formData.get('showWorkingHours') === 'true');
    formData.set('isOpen24Hours', formData.get('isOpen24Hours') === 'true');

    const workingHours = {};
    ['monday','tuesday','wednesday','thursday','friday','saturday','sunday'].forEach(day => {
      workingHours[day] = {
        from: formData.get(`workingHours[${day}][from]`),
        to: formData.get(`workingHours[${day}][to]`)
      };
      formData.delete(`workingHours[${day}][from]`);
      formData.delete(`workingHours[${day}][to]`);
    });

    formData.set('workingHours', JSON.stringify(workingHours));

    try {
      const res = await fetch('/api/employee', {
        method: 'POST',
        body: formData
      });

      const result = await res.json();

      if (res.ok && result.statusCode === 201) {
        alert('โ ุชู ุฅุถุงูุฉ ุงูููุธู ุจูุฌุงุญ');
        window.location.reload();
      } else {
        alert(`โ ุฎุทุฃ: ${result.message || 'ูุดู ุงูุฅุถุงูุฉ'}`);
      }
    } catch (err) {
      console.error('โ ูุดู ุงูุฅุฑุณุงู:', err);
      alert('โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุฅุฑุณุงู');
    }
  });
</script>

  <% } else { %>
    <p class="warning">โ๏ธ ููุฏ ูุตูุช ููุญุฏ ุงูุฃูุตู ูู ุงูููุธููู (<%= maxEmployees %>)ุ ูุง ูููู ุฅุถุงูุฉ ููุธููู ุฌุฏุฏ.</p>
  <% } %>
  <form method="POST" action="/import-employees" enctype="multipart/form-data">
  <label>๐ค ุฑูุน ููู Excel:</label>
  <input type="file" name="excelFile" accept=".xlsx" required />
  <button type="submit">๐ค ุงุณุชูุฑุงุฏ ุงูููุธููู ูู Excel</button>
</form>

<form method="GET" action="/export-employees">
  <button type="submit">๐ฅ ุชุตุฏูุฑ ุงูููุธููู ุฅูู Excel</button>
</form>

  <h3>ูุงุฆูุฉ ุงูููุธููู</h3>
  <% if (usage.employees.length > 0) { %>
    <table>
      <thead>
        <tr>
          <th>ุงูุงุณู</th>
          <th>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</th>
          <th>ุงููุณูู ุงููุธููู</th>
          <th>ุงููุงุชู</th>
          <th>ูุงุชุณุงุจ</th>
          <th>ุงููููุน</th>
          <th>ุชุตููู ุงูุจุทุงูุฉ</th>
          <th>ุงูุจุทุงูุฉ</th>
          <th>QR</th>
          <th>ุนุฏุฏ ุงูุฒูุงุฑุงุช</th>
          <th>ุชุนุฏูู</th>
          <th>ุญุฐู</th>
        </tr>
      </thead>
      <tbody>
        <% usage.employees.forEach(emp => { %>
          <tr>
            <td><%= emp.name %></td>
            <td><%= emp.email %></td>
            <td><%= emp.jobTitle %></td>
            <td><%= emp.phone %></td>
            <td><%= emp.whatsapp %></td>
            <td><%= emp.location || '-' %></td>
            <td><%= emp.designId || 'ุบูุฑ ูุญุฏุฏ' %></td>
            <td>
              <% if (emp.cardUrl) { %>
                <a href="<%= emp.cardUrl %>" target="_blank">ุนุฑุถ ุงูุจุทุงูุฉ</a> โ
              <% } else { %> โ <% } %>
            </td>
            <td>
              <% if (emp.qrCode) { %>
                <img src="<%= emp.qrCode %>" alt="QR" width="60" />
              <% } else { %> โ <% } %>
            </td>
         <td>
         <% if (typeof emp.visits === 'number') { %>
         <%= emp.visits %> ุฒูุงุฑุฉ
         <% } else { %>
          โ ุบูุฑ ูุชููุฑ
          <% } %>
        </td>
                    <td>

              <form method="GET" action="/edit-employee/<%= emp.id %>">
                <button type="submit">โ๏ธ ุชุนุฏูู</button>
              </form>
            </td>
            <td>
              <form method="POST" action="/delete-employee" onsubmit="return confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูููุธูุ');">
                <input type="hidden" name="id" value="<%= emp.id %>" />
                <button type="submit">๐๏ธ ุญุฐู</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } else { %>
    <p>ูุง ููุฌุฏ ููุธููู ุญุชู ุงูุขู</p>
  <% } %>
  <h3>ูุงุฆูุฉ ุงูุฒูุงุฑุงุช</h3>
  <% if (usage.visits && usage.visits.length > 0) { %>
    <table>
      <thead>
        <tr>
          <th>ุงูููุธู</th>
          <th>ุงููุตุฏุฑ</th>
          <th>ูุธุงู ุงูุชุดุบูู</th>
          <th>ุงููุชุตูุญ</th>
          <th>ููุน ุงูุฌูุงุฒ</th>
          <th>ุชุงุฑูุฎ ุงูุฒูุงุฑุฉ</th>
        </tr>
      </thead>
      <tbody>
        <% usage.visits.forEach(visit => { %>
          <tr>
            <td><%= visit.employee ? visit.employee.name : '-' %></td>
            <td><%= visit.source %></td>
            <td><%= visit.os %></td>
            <td><%= visit.browser %></td>
            <td><%= visit.deviceType %></td>
            <td><%= new Date(visit.visitedAt).toLocaleString("ar-EG") %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } else { %>
    <p>ูุง ุชูุฌุฏ ุฒูุงุฑุงุช ูุณุฌูุฉ ุญุชู ุงูุขู</p>
  <% } %>

<% } else { %>
  <p class="warning">โ๏ธ ูุง ููุฌุฏ ุงุดุชุฑุงู ุญุงูู ุฃู ุงูุชูุช ุงูุฎุทุฉ. ูุฑุฌู ุงูุงุดุชุฑุงู ูู ุฎุทุฉ ุฌุฏูุฏุฉ.</p>
  <form method="GET" action="/plans">
    <button type="submit">ุงูุฐูุงุจ ููุงุดุชุฑุงูุงุช</button>
  </form>
<% } %>

</body>
</html>
